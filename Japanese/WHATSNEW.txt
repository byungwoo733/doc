2.1
この節は VEOS version 2.0.3 から 2.1 の変更を記載しています。

概要   : VE Offload機能 (VEO) のサポート
タイプ : 機能拡張
詳細   : VEO はVE 上でアクセラレータプログラミングを提供します。VEO は
         VH 上のメインプログラムから VE プログラムの実行を制御します。
         VEO を用いて、VE とVH 両方の計算資源を使うプログラムを開発する
         ことができます。詳細は VEOS のドキュメント "The tutorial and 
         API reference of veoffload" を参照してください。

概要   : VH Call API の引数渡し改善
タイプ : 機能拡張
詳細   : VH Call は VE のプロセスから VH 用にコンパイルされた共有ライブ
         ラリ関数を呼び出すための機能です。この改善で任意の個数、任意の
         型の引数渡しを伴う関数呼び出しが可能になります。また、改善され
         た API を用いて Fortran ライブラリの関数を呼び出すことも可能で
         す。詳細は VEOS のドキュメント "The tutorial and API reference 
         of libsysve" を参照してください。

概要   : VE 用 glibc 'ldd' コマンドのサポート
タイプ : 機能拡張
詳細   : ldd は VE アーキテクチャ用のダイナミックリンクのバイナリが要求
         する共有ライブラリを表示します。

概要   : Infiniband 環境での 高速 I/O のサポート
タイプ : 機能拡張
詳細   : Infiniband 環境での高速 I/O をサポートされました。VEOS のドキュ
         メント"VEプログラムの実行方法"を参照してください。

概要   : VE_NODE_NUMBER 環境変数がセットされていない場合、VE ノード '0'
         を使うように複数のコマンドの動作を変更
タイプ : 機能拡張
詳細   : VE_NODE_NUMBER 環境変数によってどのノードも指定されていない時、
         以下のコマンドはデフォルトで VE ノード '0' を使います。
          - tload, top (オプションにかかわらず)
          - iostat, mpstat, pidstat, sadc, sadf, sar, vmstat, free
            (delay/interval/count オプションを指定した場合)
          - accton (ファイル名を指定した場合)
          - sa ('--other-usracct-file/--other-savacct-file/
                 --other-acct-file' オプションを指定した場合)
          - taskset, prlimit, time, strace (プロセスを起動する場合)

概要 	: VE-VH間のデータ転送性能の向上 
タイプ 	: 機能拡張 
詳細 	: VE-VH間データ転送におけるVEドライバ処理の効率化を行いました。
	  この効率化により、read()/write()システムコール等のVE-VH間の
	  データ転送性能が向上します。

概要   : VEOSが作成するログファイルの名前を、VE ノード番号を含むように改善
タイプ : 機能拡張
詳細   : VEOS が作成するログファイルの名前を、 veos.log.X から
         veosN.log.X に変更しました(N は VE ノード番号で、X は通し番号
         です)。ログファイルが保存されるディレクトリは
         /var/opt/nec/ve/veos から変更はありません。

概要   : musl-libc 関連のパッケージの削除
タイプ : 機能拡張
詳細   : NEC が VE 向けの musl-libc のサポートを終了したため、 musl-libc
         関連パッケージを削除しました。削除したパッケージは次の通りです。
            musl-libc-ve musl-libc-ve-devel libsysve-musl
            libsysve-musl-devel veos-musl-header
         これらがインストールされている場合は、アンインストールをお願い
         します。

概要   : VE プロセスの環境変数に常に VE_NODE_NUMBER をセットするように
         execve() システムコールを改善
タイプ : 機能拡張
詳細   : execve() の envp (第三引数) に NULL が指定された場合でも、
         環境変数 VE_NODE_NUMBER が設定されるように execve() の機能を
         改善しました。プロセスが実行される VE ノード番号は
         VE_NODE_NUMBER によって決定されます。

概要   : C++プログラムのためのlibsysveヘッダファイル更新
タイプ : 機能拡張
詳細   : C++ ユーザプログラムがインクルードするために、 ヘッダファイル 
         libvhcall.h, veaio.h, vedma.h, vhshm.h を更新しました。

概要   : glibc 内の I/O バッファ割り当て方法を変更
タイプ : 機能拡張
詳細   : ファイル I/O API (fread()/fwrite()等) は I/O バッファ を 
         無名ページからではなく、ヒープから取得します。

概要   : VE プロセスの開始時間、経過時間、ユーザ時間の計算アルゴリズム
         の改善
タイプ : 機能拡張
詳細   : 経過時間、ユーザ時間の単位を VH と同じになるように、計算アル
         ゴリズムを改善しました。また、VE プロセスの開始時間を execve() 
         実行後も引き継ぐように改善しました。

概要   : VE 用コマンドと getppid() の間で PPID 値に違いが出ないように
         VE 用コマンドの機能を更新
タイプ : 機能拡張
詳細   : 従来 VE 用コマンドは ve_exec で起動された VE プロセスの PPID 
         に 1 を表示していました。'top', 'ps', 'prtstat' コマンドは VE 
         プロセスの PPID に、そのプロセスを起動したシェルの PID を表示
         するようになります。また、その挙動を getppid() システムコール
         と一致させました。

概要   : 共有メモリマップドファイルのデータがファイルに書き戻されない
         問題の修正
タイプ : バグ修正
詳細   : 'MAP_SHARED' フラグと'PROT_WRITE'権限を指定して作成したメモリ
         マップドファイルを、munmap() の呼び出し、または プロセスを終了
         する前に 'MAP_PRIVATE' フラグと 'PROT_READ' を指定して再度
         マップしなおすと、関連付けられたファイルにデータを書き戻しま
         せん。

概要   : メモリマップドファイルの msync() が失敗する問題の修正
タイプ : バグ修正
詳細   : mmap() の第一引数が有効な値であり、かつ、以下のどちらかの条件
         が成立する場合に、メモリマップドファイルへの msync() が失敗し
         ます。
         - メモリマップドファイルの開始アドレスが 512MB 境界ではなく、
           領域が次の 512MB 境界を越え、使用ページサイズが 2MB ページ
           である場合
         - メモリマップドファイルの開始アドレスが 16GB 境界ではなく、
           領域が次の 16GB 境界を越え、使用ページサイズが 64MB ページ
           である場合
         メモリマップドファイルが mmap() の第一引数に NULL を指定され
         て作成された場合は、この問題は発生しません。


概要   : MAP_FIXED 無しにユーザがアドレス指定して要求した mmap が失敗
         する問題の修正
タイプ : バグ修正
詳細   : ユーザが、 2MB ページのメモリを 512MB 境界でない開始アドレス、
         または、64MB ページのメモリを 16GB 境界でない開始アドレスを
         指定して、 MAP_FIXED 無しに mmap() を要求した場合、メモリマッ
         ピングが失敗する場合が有ります。

概要   : 特権ユーザが "/" にコアダンプファイルを作成しようとした時、
         誤ったファイル名で作成される問題の修正
タイプ : バグ修正
詳細   : 特権ユーザが VE プロセスのコアダンプを採取するため、パス "/" 
         に VE コアダンプファイルを作ろうとすると、VEOS が誤った名前で
         VE コアダンプファイルを作成します。

概要   : setjump() を共有ライブラリの中から実行するとプログラムがセグ
         メンテーションフォールト を起こす問題の修正
タイプ : バグ修正
詳細   : setjmp() が共有ライブラリから実行されると、VE レジスタの一つ
         が予期せず更新されるため、プログラムの処理が進んだ所でセグ
         メンテーションフォールトが発生します。

概要   : "/opt/nec/ve/bin/pidstat -l" がセグメンテーションフォールトを
         起こす問題の修正
タイプ : バグ修正
詳細   : VE 用コマンド "/opt/nec/ve/bin/pidstat -l" がゾンビプロセスの
         情報を表示しようとすると、コマンドがセグメンテーションフォール
         トにより終了します。

概要   : VE 用 time コマンドで起動された VE プログラムが execve() で
         VH プログラムを実行した場合、VE 用 time コマンドが失敗する問題
         を修正
タイプ : バグ修正
詳細   : VE 用 time コマンドで起動された VE プロセスが execve() で VH
         プロセスを実行すると、time コマンドは "No such process" エラー
         で失敗します。

概要   : アカウンティングファイルにユーザが作成したのではない 
         "Dummy_task" が記録される問題の修正
タイプ : バグ修正
詳細   : VE 用プロセスアカウンティングが有効で、VE 用 time コマンドが
         プロセスの実行に失敗した場合、アカウンティングファイルに
         "Dummy_task" エントリが記録されます。しかし、その名前のタスク
         が作成されることは有りません。

概要   : VH 用バイナリを VE 用 time コマンドで起動すると、アカウン
         ティングファイルに "Dummy_task" が記録される問題の修正
タイプ : バグ修正
詳細   : VE 用 time コマンドで VH 用バイナリを実行すると、実行は成功
         しますが、 VE 用のアカウンティングファイルに "Dummy_task" が
         記録されます。そのため同様の VE 用コマンド taskset、prlimit、
         time を VE バイナリのみ実行可能とし、VH バイナリをこれらの
         コマンドから直接実行できないように変更しました。


2.0.3
この節は VEOS version 2.0.1 から 2.0.3 の変更を記載しています。

概要   : glibc API が使用する内部バッファのメモリ消費改善
タイプ : 機能拡張
詳細   : VE バイナリのデフォルトページサイズに関わらず、printf()、
         dprintf() などの内部バッファを利用する API は 2MB ページを
         使用します。 デフォルトページサイズが 64MB の場合、 前の
         バージョンと比較して、これらの API のメモリ消費は 62MB
         削減されます。

概要   : memcpy() 性能の改善
タイプ : 機能拡張
詳細   : 小さいサイズのデータコピー/転送にベクトル対応 memcpy() を使
         用し、性能を改善しました。性能が改善される API は fread(), 
         fwrite(), strcpy(), stpcpy(), strncat() などです。

概要   : system() のメモリ消費改善
タイプ : 機能拡張
詳細   : system() から VH プログラムを実行する際に VE メモリを消費し
         ないように、要求を VH 側で処理するようにします。ユーザは 僅
         かなメモリ消費で VE から system() で VH プログラムを実行する
         ことができます。

概要   : glibc の特定バージョンにおける openat() の制限を解除
タイプ : 機能拡張
詳細   : 引数にフラグ "O_TMPFILE | O_RDWR" と mode を指定した openat()
         によってシンボリックリンクファイルを作成し、それを引き数
         (oldpath) に指定して linkat() でハードリンクファイルを作成した
         時の、パーミッションを設定するライブラリ処理を修正しました。

概要   : VE プロセスレジスタを取得しようとした時 VEOS 性能が低下する
         問題の修正
タイプ : バグ修正
詳細   : libveosinfo ライブラリに含まれる ve_get_regvals() を使って
         VE プロセスレジスタを取得しようとした時、VEOS の性能が著しく
         低下します。

概要   : マルチスレッド環境において、sched_setaffinity() システムコール
         と taskset コマンドがセグメンテーションフォールトを起こすこと
         がある問題の修正
タイプ : バグ修正
詳細   : マルチスレッド環境において、sched_setaffinity() システムコー
         ルまたは、taskset コマンドによって、スレッドをある VE コアか
         ら別の VE コアに移動させた時に、スレッドのコンテキストの一部
         であるメモリ/アドレス変換が新しい VE コアに復元されず、スレッ
         ドがセグメンテーションフォールト(SIGSEGV)を起こします。


2.0.1

概要   : VE 用 glibc のサポート
タイプ : 機能拡張
詳細   : VE 用 glibc が利用できます。追加の情報については VEOS の
         ドキュメント "VEプログラムの実行方法" と "Cライブラリ
         （Glibc)の相違点" を参照してください。

概要   : 高速 I/O のサポート
タイプ : 機能拡張
詳細   : 「高速 I/O」はVEとVH間のデータ転送を効率的に行うことで、I/O
         性能を向上します。本機能は、'libveaccio' ライブラリに含まれ
         ます。このライブラリを実行時にロードすることで、高速I/Oが
         有効になります。使用方法については、VEOS のドキュメント "VE
         プログラムの実行方法" を参照してください。

概要   : ノンアトミック I/O のサポート
タイプ : 機能拡張
詳細   : read/write 系と send/recv 系のシステムコール (msghdr 構造体,
         mmsghdr 構造体を使う send/recv を除く) のノンアトミック I/O
         版をサポートします。ノンアトミックモード I/O において、要求
         されたサイズが 64MB を超える場合、I/O 命令は複数の 64MB 単位
         の I/O に分割されます。このノンアトミック I/O は VH 側のメモ
         リ消費を削減します。

概要   : ve_exec が SIGSEGV で異常終了する問題の修正
         修正
タイプ : バグ修正
詳細   : VE プロセスがマルチスレッドで動作している時、VE スレッドが
         exit_group() システムコールを実行すると、ve_exec の中で
         exit_group() の処理が VE タスクの状態を追跡するための領域
         を解放します。同時に別のスレッドがその領域にアクセスしよう
         とすると、セグメンテーションフォールトが発生します。

概要   : ve_get_regvals() 実行中に VE プロセスがハングアップする問題
         の修正
タイプ : バグ修正
詳細   : ve_get_regvals() の処理において、VEOS が誤った VE タスクの
         扱いをしていたため、VE タスクが VE コアにスケジュールされ
         なくなります。その結果 VE プロセスはハングアップしたように
         なります。

概要   : execve() システムコールを実行するとグローバル変数 "environ" 
         にエントリが重複して追加される問題を修正
タイプ : バグ修正
詳細   : VE プログラムが VE バイナリをロードする execve() を
         再帰的に呼び出すと、LOG4C_RCPATH や VE_EXEC_PATH 等の環境
         変数がグローバル変数 "environ" に重複して追加されます。外部
         変数の総数が増えるため、execve() システムコールの失敗に
         繋がります。

概要   : VE 用 'sadc' コマンドが終了しない問題の修正
タイプ : バグ修正
詳細   : VE 用 'sadc' コマンドは HW データのファイルの構文解析に失敗
         した場合、ハングアップします。そのため、cron ジョブによって
         定期的に起動された 'sadc' コマンドは残り続けます。


1.3.2

概要   : write() 系システムコールの性能を改善
タイプ : 機能拡張
詳細   : write() 系システムコールの性能を改善するために、システムコール
         処理の VE メモリからのデータ読み込みを更新しました。
         write() 系システムコールは write(), writev(), pwrite(), 
         pwritev() が該当します。

概要   : VE-VH間のデータ転送性能の向上
タイプ : 機能強化
詳細   : VE ドライバが提供している、データ転送対象のVH メモリ管理機能
	 を改善しました。VH メモリ管理リストを改善したことにより、
	 read()/write()システムコール等のVE-VH間のデータ転送性能が向上
         します。

概要   : VE AIO のログメッセージ改善
タイプ : 機能拡張
詳細   : いくつかのログメッセージを改善しました。VE AIOのエラーにより
         プロセスがアボートされる場合、標準エラー出力にメッセージを出
         力します。

概要   : vfork() システムコールで生成された VE プロセスのスケジュー
         リング中に VEOS が異常終了する問題の修正
タイプ : バグ修正
詳細   : vfork() で生成された VE プロセスのプロセス管理情報が VEOS 内
         で適切に設定されません。そのため、vfork で生成された子VEプロ
         セスのスケジューリングを行った際 VEOS が異常終了します。

概要   : vfork() システムコールで生成された VE プロセスがゾンビ状態で
         残留する問題の修正
タイプ : バグ修正
詳細   : vfork() で生成された子VEプロセスが終了するとき、既に終了してい
         る親 VE プロセスを起こそうとして、VEOS の中でデッドロックを引
         き起こした結果、子VEプロセスがゾンビ状態で残留します。

概要   : 代替シグナルスタック上でシグナルハンドラを連続して実行しよう
         とすると、VE プロセスがハングアップする問題の修正
タイプ : バグ修正
詳細   : VEOS がコアのレジスタを不完全に読み込むため、プロセスが代替
         シグナルスタック上で動作していないと誤って認識します。この
         問題は、動作不定の振る舞いを引き起こします。

概要   : ヒープの開始アドレスよりもヒープを減らそうとした場合、VE プロ
         セスが SIGSEGV を受信する問題の修正
タイプ : バグ修正
詳細   : brk() システムコールの処理が誤っていたため、ライブラリによっ
         てマップされた TLS 領域がアンマップされ、VE プロセスが 
         SIGSEGV で終了します。

概要   : sysinfo() システムコールによって要求された 'freeram' フィール
         ドが適切にアップデートされない問題の修正
タイプ : バグ修正
詳細   : sysinfo() システムコールが適切に更新されていない誤った 
         freeram (未使用メモリの総量) を返すため、VE プロセスは誤った
         値を取得します。

概要   : pthread_exit() を実行しても VE プロセスの解放処理が実行され
         ない問題の修正
タイプ : バグ修正
詳細   : 終了処理中の VE スレッドに対し SIGCONT が送られた場合、VE
         プロセスの解放処理が正しく行われないため、 スレッドに関係
         していたリソースが解放されないことがあります。

概要   : VE プロセスのスタックが延ばされた時に VE strace コマンドが
         VE プロセスを正しく実行できない問題の修正
タイプ : バグ修正
詳細   : VE strace コマンドは VE プロセスのスタックを伸長する grow()
         システムコールをトレースできないため、VE strace コマンドは
         動作不定の振る舞いをします。



1.3

概要   : clock_gettime(), gettimeofday() の性能を改善
タイプ : 機能拡張
詳細   : 'CLOCK_MONOTONIC' を指定した clock_gettime() と、gettimeofday()
         の性能を改善しました。プロセスまたはスレッドが、 gettimeofday()
         によるシステム時間を要求、または clock_gettime()によるモノト
         ニック時間を要求した場合、最初のリクエストでは VH のシステム
         コールの結果を返します。それ以降の呼び出しにおいて、同じスレッ
         ドグループの時刻は VH のシステムコールを実行した結果ではなく、
         VE 側で算出された値になります。

概要   : VE のための非同期な I/O 操作をサポート(VE AIO)
タイプ : 機能拡張
詳細   : VE のための非同期な I/O 操作をサポートしました。VE AIO 用の関
         数は 'libsysve' ライブラリに含まれます。VE と VH 間でのデータ
         転送と実際の I/O 処理は非同期に行われ、VE 上のプログラムはその
         間も処理を進めることができます。

概要   : ロード失敗の原因解析のための標準エラーメッセージ出力の追加
タイプ : 機能拡張
詳細   : 実行ファイルのロードが失敗した場合に、標準エラー出力にエラー
         メッセージを出力するように変更しました。このメッセージはユー
         ザにロード失敗について有益な情報を提供します。

概要   : VE プロセスが SIGBUS で異常終了する問題の修正
タイプ : バグ修正
詳細   : ユーザが共有ライブラリの bss 領域に futex を置いた場合、VE
         プロセスが SIGBUS で異常終了する場合があります。

概要   : VE プロセスが SIGFPE で異常終了する問題の修正
タイプ : バグ修正
詳細   : ユーザが mprotect() を NULL アドレスを指定して実行した場合、
         VE プロセスが SIGFPE で異常終了する場合があります。

概要   : スレッドが無期限に停止する問題の修正
タイプ : バグ修正
詳細   : fork() によって作成された親プロセスが pthread_create() で作成
         したスレッドが join しようとした時、親プロセスが既に終了して
         いると、スレッドは無期限に停止します。

概要   : write() 系システムコールが失敗することがある問題の修正
タイプ : バグ修正
詳細   : fork()/vfork()/system() を別のスレッドで同時に実行すると、
         write() 系システムコールが失敗することが有ります。write(), 
         writev(), pwrite(), pwritev() が該当します。

概要   : スレッドのシグナルマスクと保留中のシグナルが execve() 前後で
         保存されない問題の修正
タイプ : バグ修正
詳細   : execve() の前後でスレッドのシグナルマスクが保存されません。
         言い換えると、シグナルがブロックされたスレッドが execve() を
         実行した後、新しくロードされたプロセスはシグナルがマスクされ
         ません。同様に、VEOS 内で保留している VE プロセス宛てのシグ
         ナルも execve() 前後で保存されません。

概要   : 代替シグナルスタックで実行していないにも関わらず、代替シグ
         ナルスタックで実行していると VE プロセスが誤った情報を返す
         問題の修正
タイプ : バグ修正
詳細   : 代替シグナルスタックでシグナルハンドラを実行し、longjmp()で
         通常のスタックに戻った VE プロセスについて、 VEOS は最新の
         スタック情報を保持していません。そのため sigaltstack() シス
         テムコールは、いまだに代替シグナルスタックで実行をしていると
         いう誤った情報を返します。

概要   : swprintf() が変換指定子 '%lc' に対し誤った値を返す問題を修正
タイプ : バグ修正
詳細   : swprintf() に '%lc' (ワイド文字)を指定したとき、書き込んだ
         バイト数ではなく、-1 を返します。

概要   : musl-libc が使用する、動的ロードしたデータ用に 2MB ではなく 
         64MB をユーザプロセスが消費する問題の修正
タイプ : バグ修正
詳細   : デフォルトページサイズが 64MB になるようにコンパイルされたプ
         ログラムが localtime() の様な API を使用する場合、ライブラリ
         は '/usr/share/zoneinfo/*' にある zoneinfo データ用に、必要
         サイズが 2MB 以下であっても 64MB を消費します。

概要   : プロセス/スレッドの CPU 時刻 のクロック ID 指定時、
         timer_create() が -1 ではなく、無効な値を返す問題の修正
タイプ : バグ修正
詳細   : clock_getcpuclockid()/pthread_getcpuclockid() によって取得
         した clock_id を指定して timer_create() を実行した場合、
         timer_create() は errno に EINVAL をセットして失敗しません。
         (VE 用 timer_create() は プロセス/スレッドの CPU 時刻 の
         クロック ID をサポートしていません。)

概要   : プロセス/スレッドの CPU 時刻 のクロック ID を指定して、
         clock_nanosleep() を実行したとき、-1 を返すのではなく、無期限
         にスリープします。
タイプ : バグ修正
詳細   : clock_getcpuclockid()/pthread_getcpuclockid() によって取得
         した clock_id を指定して clock_nanosleep() を実行した場合、
         errno に EINVAL をセットして失敗しません。
         (VE 用 clock_nanosleep() は プロセス/スレッドの CPU 時刻 の
         クロック ID をサポートしていません。)

概要   : VE のプロセスアカウンティング機能を一度も有効にした事がない
         場合、アカウンティングファイルのログローテーションが失敗する
         問題の修正
タイプ : バグ修正
詳細   : SELinux が有効で、一度も VE のアカウンティング機能を有効に
         していない場合のみ、"acct_data_t" であるべき 
         "/var/opt/nec/ve/account" のコンテキストが誤った "var_t" に
         なっているため、 'cron.daily' によって起動された VE アカウン
         ティングファイルのログローテーションが失敗します。

1.2.2

概要   : バイナリ起動時とexecve システムコール実行時に渡す引き数と
         環境変数の最大数を引き上げ
タイプ : 機能拡張
詳細   : バイナリ起動時とexecve システムコール実行時に渡す事が可能な
         引数の数と環境変数の数を 256 から 512 に増やしました。

概要   : ユーザレジスタを取得するための、 libveosinfo の新しい API
タイプ : 機能拡張
詳細   : ve_get_regvals() という名前の新しい API が libveosinfo に追加
         されました。この API は VH プロセスから VE プロセスのユーザレ
         ジスタの値を取得することができます。libveosinfo を使用する
         あなたのプログラムをビルドするためには、'veosinfo-devel' パッ
         ケージをインストールする必要があります。

概要   : VEOS 内においてスレッド生成処理に失敗したとき、VEOSが異常終了
         する問題の修正
タイプ : バグ修正
詳細   : ve_exec が作成したメインプロセスからのスレッド生成要求が VEOS
         内で失敗した場合、初期化途中の VE タスクの削除中に未初期化の
         フィールドにアクセスし VEOS が異常終了する場合があります。

概要   : シグナルハンドラ実行中に VE プロセスが kill される問題の修正
タイプ : バグ修正
詳細   : VEOS がシグナルハンドラのスタックフレームを作成するとき、DMA
         用にアラインされていないメモリアドレスを設定するため、VE プロ
         セスがシグナルハンドラを実行するとき VE プロセスが異常終了す
         る場合があります。

概要   : 更新時に /dev/veslotN が消える問題の修正
タイプ : バグ修正
詳細   : "change" アクション発生時にリンク /dev/veslotN が削除されて
         いました。"change" アクションは一部の RPM パッケージの更新の
         際に実行される 'udevadm trigger' コマンドにより発生します。

概要   : 'veos' パッケージのアップデートが進まなくなる問題の修正
タイプ : 回避策
詳細   : 古いバージョンの 'veos' パッケージは、アップデート時に
         'systemd-binfmt' を再起動します。autofs 関連の問題のため、その
         処理が完了せず、'veos' パッケージのアップデートが先に進まなく
         なることがあります。

概要   : 'top/mpstat/pidstat' コマンドが誤った user, idle を表示する
         問題の修正
タイプ : バグ修正
詳細   : 'top' コマンドはデフォルトの表示において %Cpu(s) フィールドの
         user と idle のパーセンテージに誤った値を表示します。また、
         'mpstat' と 'pidstat' コマンドも 更新の間隔/回数 を指定しない
         場合に %user と %idle に誤った値を表示します。

概要   : 'prtstat' コマンドがいくつかの項目で誤った値を表示する問題の
         修正
タイプ : バグ修正
詳細   : 'prtstat' コマンドは pgrp, tty_nr, session, tpgid, num_threads,
         exit_signal について誤ったデータを表示します。

概要   : clock_gettime() システムコールが誤ったエラー番号をセットする
         問題の修正
タイプ : バグ修正
詳細   : 誤った clock_id を指定したとき、clock_gettime() は EINVAL で
         はなく EFAULT を errno にセットして失敗を返します。また、
         clock_id が INIT プロセスの CPU 時刻である場合、VEOS は INIT
         プロセスを持たないため、errno に EINVAL をセットして失敗します。


1.2.1

概要   : VEOS 性能改善のため負荷調整機能を追加
タイプ : 機能拡張
詳細   : 負荷調整機能をサポートすることで、 VEOS は、実行キューに VE
         タスクが 2 つ以上登録されている VE コアから、VE タスクが無い 
         VE コアに VE タスクを移動させます。この機能により、MPI を含む
         マルチプロセス/マルチスレッドプログラムの性能が改善します。

概要   : I/O性能の改善
タイプ : 機能拡張
詳細   : DMA転送の改善により、複数プロセスからの同時アクセスの I/O 
         性能が向上しました。

概要   : NOSUID でマウントされているディレクトリ上のプログラムが実行
         できない問題の修正
タイプ : バグ修正
詳細   : "nosuid" オプション付きでマウントされているファイルシステム上
         にある実行ファイルを、VEOS は起動または execve() で実行できま
         せん。

概要   : clock_gettime() が誤った timespec を返却する問題の修正
タイプ : バグ修正
詳細   : clock_gettime() に clock_getcpuclockid() で取得した他のプロセ
         スの CPU 時刻のクロック ID を指定しても、常に呼び出し元のプロ
         セスの実行時間を返します。

概要   : vfork() で作成した子プロセスが終了する前に親プロセスが実行を
         再開する問題の修正
タイプ : バグ修正
詳細   : vfork() で作成した子プロセスが終了する前に親プロセスが実行を
         再開すると、wait() の結果が意図しない結果になります。

概要   : マルチスレッドの VE プロセスが malloc() と free() を並列に実行
         すると異常終了する問題を修正
タイプ : バグ修正
詳細   : musl-libc のメモリ管理データの保護に問題があり、 malloc() と 
         free() を並列に実行するマルチスレッドの VE プログラムが異常
         終了する場合があります。

概要   : mmap() が不正なエラーコードを返す問題を修正
タイプ : バグ修正
詳細   : mmap() が失敗するいくつかのケースに置いて、誤ったエラーコード
         が VE プログラムに返却されます。(例) 誤った size または fd が 
         mmap() に渡された場合、EBADF が errno にセットされるべきところ、
         EINVAL が errno にセットされます。MAP_FIXED フラグが NULL アド
         レスと共に mmap() に渡された場合、EPERM が errno にセットされ
         るべきところ、 ENOMEM が errno にセットされます。

概要   : getresgid() が不正なエラーコードを返す問題を修正
タイプ : バグ修正
詳細   : getresgid() の処理中、期待された引数の内の一つが失われ、予期
         しない EFAULT が返却されることが有ります。


1.2

概要   : NEC システムソフトウェア向け DMA 転送性能改善
タイプ : 機能拡張
詳細   : ScaTeFS ライブラリ等、 VE プログラムにリンクされる NEC システ
         ムソフトウェア向けの DMA 転送機能をサポートします。これにより、
         データ転送性能を改善できます。この機能は NEC システムソフトウェ
         ア専用に実装されているため、本機能をユーザプログラムが直接利用
         した場合、NECは一切の技術サポートを行いません。

概要   : データ転送性能とメモリ消費の改善
タイプ : 機能拡張
詳細   : read()/write() 等のシステムコールを使った、大きなメモリ
         転送の性能を改善しました。

概要   : VEプロセスからのメモリ解放要求に対するVEOSのレスポンス改善
タイプ : 機能拡張
詳細   : 物理メモリ解放初期化を非同期に行うように変更し、VEプロセス
         のメモリ解放要求のレスポンスを向上します。 新たにメモリを要
         求された時に十分な物理メモリの初期化を完了していない場合、
         要求したサイズの空き領域が確保されるまでメモリ割当要求は待
         たされます。

概要   : libvepseudo のライセンスを LGPL に変更
タイプ : 機能拡張
詳細   : 疑似プロセスを構成するコンポーネントの一つである 
         libvepseudo ライブラリのライセンスを GPL から LGPL に
         変更しました。

概要   : VE プロセス 異常終了の修正
タイプ : バグ修正
詳細   : サイズが 0 のファイルをメモリにマップしている VE プログ
         ラム が vfork() を実行した時、 VEOS が再起動し、同ノード
         で動作している全ての VE プロセスが終了する場合があります。

概要   : VEOS の仮想メモリ消費量が増え続ける問題の修正
タイプ : バグ修正
詳細   : VE プロセスがコアを生成する時、VEOS の仮想メモリ使用量
         は徐々に増加していき、コア生成終了後も仮想メモリ使用量
         は元の値に戻りません。

概要   : VE で "host missing page exception" が発生しても SIGSEGV
         を VE プロセスが受け取れない問題の修正
タイプ : バグ修正
詳細   : VE プロセスはシグナル(SIGSEGV)受信時に終了させられること
         無く、実行を継続します。

概要   : fork()に失敗し 子プロセスの生成に失敗する問題の修正
タイプ : バグ修正
詳細   : VE プロセスが無効な CPU_SET を指定して sched_setaffinity 
         を実行した場合、それ以降の fork() は失敗します。

概要   : VH 起動時の psacct-ve サービス起動失敗の修正
タイプ : バグ修正
詳細   : psacct-ve サービスは VEOS が動作している事を前提に
         しています。psacct-ve サービスが 'enabled' に設定
         されている場合、VH 再起動時に VEOS 起動よりも前に
         psacct-ve が開始され、サービス開始に失敗することが
         あります。

概要   : vmstat と sar コマンドの 'blocked' プロセスの値に不正
         値が表示される問題の修正
タイプ : バグ修正
詳細   : VEOS は 'blocked' プロセス (I/O完了待ちのプロセス) の数を
         カウントするための情報を管理していないため、 VE 用 vmstat 
         コマンドと sar コマンドが表示する 'blocked' プロセスの値
         に 0 を表示するべきところ、不正な値を表示します。


1.1.1

概要   : execve() 処理中の VEOS 異常終了の修正
タイプ : バグ修正
詳細   : VEOS が execve() の処理をしている間に、要求元プロセス
         がシグナルで終了させられた場合、プロセス管理情報の
         更新に失敗し、VEOS が異常終了することがあります。

概要   : execve() をスレッドが実行しているプロセスの、スレッド
         グループリーダに SIGKILL が配送された時、VEOS が異常
         終了する問題を修正。
タイプ : バグ修正
詳細   : VEOS がスレッドからの execve() を処理している間に、
         同時にスレッドグループリーダーへの SIGKILL 配送を
         行うと、VEOS が再起動し、同ノードで動作している 
         VE プロセスが終了する場合があります。

概要   : VEOS が VH のメモリを大量消費する問題の修正
タイプ : バグ修正
詳細   : 巨大なメモリセグメントを持つプロセスのコアを生成する
         時、VEOS が大量の VH メモリを消費する場合があります。

概要   : VEOS 動作異常の修正
タイプ : バグ修正
詳細   : VEOS が VE プロセスに対し CPU アフィニティの設定処理
         と、そのプロセスに対する別のリクエストを同時に処理し
         た場合、VEOS 内部データに不整合が生じ、VEOS の動作が
         不定になります。

概要   : DMA ディスクリプタの更新失敗の修正
タイプ : バグ修正
詳細   : DMA 転送を行っている VE プロセスの DMA ディスクリプタ
         が正しく更新されず、DMAが失敗する事があります。

概要   : 子プロセス生成に成功していても fork() がエラーを返す
         問題の修正
タイプ : バグ修正
詳細   : fork() 処理中の不具合により、子プロセスの生成に成功
         していても、親プロセスに EAGAIN が返却される場合が
         あります。

概要   : VE プロセス ハングアップの修正 
タイプ : バグ修正
詳細   : プロセス(スレッド) がスケジューリングされず、ハング
         アップすることがあります。

概要   : VE プロセス 異常終了の修正
タイプ : バグ修正
詳細   : シグナルハンドラ実行のためのスタックフレームが正しく
         作成されず、VE プロセスが異常終了する場合があります。

概要   : VH メモリリークの修正
タイプ : バグ修正
詳細   : VE プロセスが子プロセスを生成・終了したとき、親プロセ
         スが終了するまで VH のメモリリークが発生します。リーク
         したメモリは 親プロセスが終了した時に解放されます。

概要   : VE プロセス実行性能低下の修正
タイプ : バグ修正
詳細   : 複数の VE プロセスを実行した後、VEOS 内部データの不
         整合が発生した場合、プロセススケジューリングに失敗す
         ることがあります。その結果、プロセス実行性能の低下が
         発生します。

概要   : GDB のバックトレースコマンドの修正
タイプ : バグ修正
詳細   : GDB で "backtrace" コマンドを実行したとき、シグナルに割り
         込まれた関数のフレームが表示されません。

概要   : 特権DMA転送性能の改善
タイプ : 機能拡張
詳細   : VEOSが使用する特権DMA転送の性能を改善しました。これ
         により、システムコール(read()/write())実行時等の性能
         が向上します。

概要   : MPI や他のシステムライブラリのデータ転送速度を改善する
         機能のサポート
タイプ : 機能拡張
詳細   : MPI ライブラリまたは他のシステムライブラリのデータ転送
         速度を改善するために、VE プログラムが VH 側の System V
         shared memory へアクセス可能にする機能を提供します。そ
         れらのライブラリが、huge pages を使って System V shared
         memory を生成します。本機能は、対応するMPI ライブラリま
         たは他のシステムライブラリのみが使用できます。本機能を
         ユーザープログラムから直接使用した場合、NEC は一切の技
         術サポートを行いません。

概要   : コンテキストスイッチ性能の改善
タイプ : 機能拡張
詳細   : VEプロセス/スレッド間のコンテキストスイッチの性能
         を改善しました。

概要   : コアダンプ生成時間の改善
タイプ : 機能拡張
詳細   : VH で巨大な I/O を行っている間に VE プロセスのコア
         ダンプが行われた場合、コア生成に時間が掛かり、その間
         は ve_exec のスレッドが割り込み不可能なスリープ状態
         (Uninterruptible sleep) で残り続けます。
         コア生成処理を改善し、コア生成とスレッド解放までの時
         間を短縮しました。

概要   : sar によるシステムアクティビティデータ収集・蓄積の
         サポート
タイプ : 機能拡張
詳細   : sar によるシステムアクティビティデータの収集・蓄積を
         提供します。これに合わせて、ve_sysstat サービスが VE
         ノードと対応するように ve_sysstat@N (N は VE ノード
         番号) に変更されました。

概要   : sar コマンドの出力 "LINUX RESTART" を "VEOS RESTART"
         に変更
タイプ : 機能拡張
詳細   : VEOS を再起動した時に、sar コマンド結果に挿入される
         文字列を "LINUX RESTART" から "VEOS RESTART" に変更
         しました。

概要   : ipcs コマンドと ipcrm コマンドのサポート
タイプ : 機能拡張
詳細   : VE 用 ipcs コマンドと ipcrm コマンドを提供します。
         これらのコマンドは util-linux-ve パッケージに含まれ
         ます。


1.0.3

概要   : RHEL7.4/x86_64サポート
タイプ : 機能拡張
詳細   : RHEL7.4/x86_64 が新たにサポートされました。サポート
         しているプラットフォームとオペレーティングシステムに
         ついては README を参照してください。

概要   : binfmt 設定ファイルの配布
タイプ : 機能拡張
詳細   : VE 用 binfmt の設定ファイル (ve.conf) が 
        /usr/lib/binfmt.d/ に配置されるようになります。
        ユーザは ve_exec の指定をすることなく VEプログラム
        を実行することができます。 複数のVEが搭載されている
        場合、VEプログラムを実行する VEノードを環境変数
        (VE_NODE_NUMBER)で指定します。


1.0.2

概要   : シグナルハンドラ処理中のVEプロセス異常終了の修正
タイプ : バグ修正
詳細   : シグナルハンドラの処理に必要なスタック領域が確保
         できなかった場合、VE プロセスが kill されます。

概要   : VE プロセス ハングアップの修正 
タイプ : バグ修正
詳細   : VE プロセスが使用しているスタックの大半が使用され
         ている時に、そのVEプロセスに対してシグナルが送られ
         ると、稀にVEプロセスがハングアップすることがありま
         す。
         
概要   : VE プロセス 異常終了の修正
タイプ : バグ修正
詳細   : 同一の System V 共有メモリに対する shmdt()システム
         コールと shmctl() システムコールの処理要求が同時に 
         VEOS に到着した場合、その VEOS が再起動し、同ノード
         で動作している全ての VE プロセスが終了する場合が
         あります。

概要   : 巨大な TLS を使用するスレッドのスタック属性が指定
         された場合に pthread_create() が失敗する問題の修正
タイプ : バグ修正
詳細   : アプリケーションがスレッドのスタック属性を指定し、
         かつ、巨大な TLS を使用する場合に pthread_create()
         のスタック生成処理が失敗し EAGAIN が返却されます。

概要   : "sar -m" コマンドと共にインターバルを指定した場合に
         不正な情報が表示される問題の修正
タイプ : バグ修正
詳細   : "sar -m" コマンドと共にインターバル(-i オプション) 
         を指定すると、不正なセンサ情報が出力されます。 

概要   : kill(2) システムコール完了前に VE プロセス自身への
         シグナル配送を行うように処理を改善
タイプ : 機能拡張
詳細   : tkill(2),tgkill(2)を含むkill(2)関連システムコールで
         自分自身(VEプロセス自身)にシグナルを送った場合、
         シグナルは直ちにVEプロセスに配送されます。

概要   : VEOS ログメッセージの改善
タイプ : 機能拡張
詳細   : VEOS ログのメッセージ内容と出力レベルを変更しました。

概要   : VEOS RPM パッケージ名の改善
タイプ : 機能拡張
詳細   : SX-Aurora TSUBASA の RPM パッケージ名標準に準拠する
         ように、VEOS の RPM パッケージ名を変更しました。

1.0.1 - initial release

